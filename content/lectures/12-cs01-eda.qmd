---
title: "12-cs01-eda"
author: "Professor Shannon Ellis"
date: "2023-02-21"

format:
  html: 
    output-file: 12-cs01-eda.html
    embed-resources: true
  revealjs:
    output-file: 12-cs01-eda-slides.html
    slide-number: true
    chalkboard: false 
    preview-links: auto
    logo: images/cogs137-logo-hex.png
    css: slides.css
    footer: <https://cogs137.github.io/website/>
    scrollable: true
    embed-resources: true
    execute:
      echo: true
      eval: true
---

# CS01: Right-To-Carry (EDA) {background-color="#92A86A"}

## Q&A {.smaller}

> Q: \
> A:

## Course Announcements

**Due Dates**:


-   Lecture Participation survey "due" after class

. . .

**Notes**:


## Agenda



# Questions {background-color="#92A86A"}

1.  What is the relationship between right to carry laws and violence rates in the US?
2.  What is the effect of multicollinearity on coefficient estimates from linear regression models when analyzing right to carry laws and violence rates?

# Packages & Data

```{r packages-load}
library(tidyverse)
library(skimr) # will need to install first
library(ggrepel) # will need to install first
```

--

This will only work if you finished the last set of notes...

```{r}
load("data/wrangled/wrangled_data_rtc.rda")
```

---

### LOTT data

.panelset[
.panel[.panel-name[glimpse]
.small[
```{r}
glimpse(LOTT_DF)
```
]]
.panel[.panel-name[skim]
.small[
```{r}
skimr::skim(LOTT_DF)
```
]]]


---

### DONOHUE data

.panelset[
.panel[.panel-name[glimpse]
.small[
```{r}
glimpse(DONOHUE_DF)
```
]]
.panel[.panel-name[skim]
.small[
```{r}
skimr::skim(DONOHUE_DF)
```
]]]

---
## Population over time
.panelset[
.panel[.panel-name[Code-1]
```{r}
df <- DONOHUE_DF |>
  group_by(YEAR) |>
  summarise(Population = sum(Population)) 
```
]
.panel[.panel-name[Code-2]
```{r population, fig.show = "hide"}
ggplot(df, aes(x = YEAR, y = Population)) +
  geom_line() +
  scale_x_continuous(
    breaks = seq(1980, 2010, by = 1),
    limits = c(1980, 2010),
    labels = c(seq(1980, 2010, by = 1))
  ) +
  labs(
    title = "Population has steadily increased",
    x = "Year",
    y = "Population"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90),
        plot.title.position = "plot")
```
]
.panel[.panel-name[Plot]

```{r ref.label="population", echo = FALSE, out.width="100%"}
```
]]
---

## Crime over time

.panelset[
.panel[.panel-name[Code-1]
.very-small[
```{r }
df <- DONOHUE_DF |>
  group_by(YEAR) |>
  summarize(
    Viol_crime_count = sum(Viol_crime_count),
    Population = sum(Population),
    .groups = "drop"
  ) |>
  mutate(Viol_crime_rate_100k_log = log((Viol_crime_count * 100000) / Population))
```
]]
.panel[.panel-name[Code-2]
```{r, donohue-overall, fig.show = "hide"}
df |>
  ggplot(aes(x = YEAR, y = Viol_crime_rate_100k_log)) +
  geom_line() +
  scale_x_continuous(
    breaks = seq(1980, 2010, by = 1),
    limits = c(1980, 2010),
    labels = c(seq(1980, 2010, by = 1))
  ) +
  scale_y_continuous(
    breaks = seq(5.75, 6.75, by = 0.25),
    limits = c(5.75, 6.75)
  ) +
  labs(
    title = "Crime rates fluctuate over time",
    x = "Year",
    y = "ln(violent crimes per 100,000 people)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90), plot.title.position = "plot")
```
]
.panel[.panel-name[Plot]

```{r ref.label="donohue-overall", echo = FALSE, out.width="100%"}
```
]]
---

## Crime over time by state

.panelset[
.panel[.panel-name[Code-1]
.very-small[
```{r}
p <- DONOHUE_DF |>
  mutate(Viol_crime_rate_100k_log = log((Viol_crime_count * 100000) / Population)) |>
  ggplot(aes(x = YEAR, y = Viol_crime_rate_100k_log, color = STATE)) +
  geom_point(size = 0.5) +
  geom_line(aes(group = STATE),
    size = 0.5,
    show.legend = FALSE
  ) +
  geom_text_repel(data = DONOHUE_DF |>
      mutate(Viol_crime_rate_100k_log = log((Viol_crime_count * 100000) / Population)) |>
      filter(YEAR == last(YEAR)),
      aes(label = STATE,x = YEAR, y = Viol_crime_rate_100k_log),
      size = 3, alpha = 1, nudge_x = 1, direction = "y",
      hjust = 1, vjust = 1, segment.size = 0.25, segment.alpha = 0.25,
      force = 1, max.iter = 9999)
```
]]
.panel[.panel-name[Code-2]
```{r donohue-state, fig.show = "hide"}
p + 
  guides(color = "none") +
  scale_x_continuous(
    breaks = seq(1980, 2015, by = 1),
    limits = c(1980, 2015),
    labels = c(seq(1980, 2010, by = 1), rep("", 5))
  ) +
  scale_y_continuous(
    breaks = seq(3.5, 8.5, by = 0.5),
    limits = c(3.5, 8.5)
  ) +
  labs(
    title = "States have different levels of crime",
    x = "Year", y = "ln(violent crimes per 100,000 people)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90), plot.title.position = "plot")
```
]
.panel[.panel-name[Plot]

```{r ref.label="donohue-state", echo = FALSE, out.width="100%"}
```
]]

---

## Police Presence over time

.panelset[
.panel[.panel-name[Code-1]
```{r}
p <- DONOHUE_DF |>
  group_by(YEAR) |>
  summarise(Police = sum(police_per_100k_lag)) |> 
  ggplot(aes(x = YEAR, y = Police)) +
  geom_line() +
  scale_x_continuous(
    breaks = seq(1980, 2010, by = 1),
    limits = c(1980, 2010),
    labels = c(seq(1980, 2010, by = 1))
  )
```
]
.panel[.panel-name[Code-2]
```{r police, fig.show = "hide"}
p +
  labs(
    title = "Police Presence has increased over time with fluctuations",
    x = "Year",
    y = "Police Presence per 100K people"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90),
        plot.title.position = "plot")
```
]
.panel[.panel-name[Plot]
```{r ref.label="police", echo = FALSE, out.width="100%"}
```
]]
