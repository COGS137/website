<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>CS02: Right-To-Carry (Data)</title>
    <meta charset="utf-8" />
    <meta name="author" content="Prof Ellis" />
    <meta name="date" content="2021-11-08" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# CS02: Right-To-Carry (Data)
### Prof Ellis
### 2021-11-08

---








## Course Announcements

- **cs01** due tonight
- **lab07**: "due Friday" but accepted until Sunday night (multiple linear regression)

**Case Study 02**:
- **hw04**: CS02 Data Wrangling (due Mon 11/15) - submitted *individually*
  - Import, Wrangling, and explanation of a subset of datasets
  - Submitted by pushing to GitHub
- **cs02**: CS02 Final Case Study (due Mon 11/22) - submitted *as a group*
  - Group repos will be created later today
---

class: center, middle

# Background

---

## Right To Carry Laws&lt;sup&gt;1&lt;/sup&gt;

.ocean[Tight to Carry (RTC) Laws] - "a law that specifies if and how citizens are allowed to have a firearm on their person or nearby (for example, in a citizen‚Äôs car) in public.&lt;sup&gt;2&lt;/sup&gt;"

.footnote[
&lt;sup&gt;1&lt;/sup&gt;Case Study Reference: Wright, Carrie and Ontiveros, Michael and Jager, Leah and Taub, Margaret and Hicks, Stephanie. (2020). https://github.com//opencasestudies/ocs-bp-RTC-analysis. Influence of Multicollinearity on Measured Impact of Right-to-Carry Gun Laws (Version v1.0.0).

&lt;sup&gt;2&lt;/sup&gt;In this discussion, we will use the National Rifle Association (NRA) terminology. Please keep in mind that there are other terms that people use.

]

---

### RTC Laws (cont'd)

- The Second Amendment to the United States Constitution guarantees the right to ‚Äúkeep and bear arms‚Äù. The amendment was ratified in 1791 as part of the Bill of Rights.

--

- There are no federal laws about carrying firearms in public.

--

- These laws are created and enforced at the US state level. States vary greatly in their laws about the right to carry firearms.

--

-  Some require extensive effort to obtain a permit to legally carry a firearm, while other states require very minimal effort to do so. An increasing number of states do not require permits at all.


---

### RTC Laws Across the US

![laws image](img/16/rtc-laws.png)

---


### RTC Laws Across the US

![laws image](img/16/rtc-map.png)


---

## Question

1. What is the effect of multicollinearity on coefficient estimates from linear regression models when analyzing right to carry laws and violence rates?

---

class: center, middle

# The Data

---

## The Data: Source&lt;sup&gt;1&lt;/sup&gt;

Two contradictory analyses: 

.small[
1. John J. Donohue et al., Right‚Äêto‚ÄêCarry Laws and Violent Crime: A Comprehensive Assessment Using Panel Data and a State‚ÄêLevel Synthetic Control Analysis. Journal of Empirical Legal Studies, 16,2 (2019).

2. David B. Mustard &amp; John Lott. Crime, Deterrence, and Right-to-Carry Concealed Handguns. Coase-Sandor Institute for Law &amp; Economics Working Paper No. 41, (1996).
]

---

## The Data: 
.small[
![variables](img/16/variables-used.png)
]
---

## Two Analyses

![analyses differ](img/16/previous-analyses.png)

---

## Limitations

1. The analyses differed in variables used; we will not be recreating either analysis in full

--

2. We'll account for either the adoption or lack of adoption of a permissive right-to-carry law in each state; we will not account for differences in the level of permissiveness of the laws.

--

3. Race is included here (as it was in initial analysis); however, any association between demographic variables (indicating the proportion of the population from specific race and age groups) and violent crime does not necessarily indicate that the two are linked causally.

---

# Packages 


```r
library(OCSdata) # if you didn't install this previously, you'll need to now
library(tidyverse)
library(pdftools)
library(readxl)
```

---

## Raw Data

There are a whole bunch of different data files we'll be using...


```r
# only get the data once
OCSdata::load_raw_data("ocs-bp-RTC-wrangling", outpath = '.')
```

- creates a "data" sub-directory in your current working directory (if it does not already exist)
- creates a "raw" sub-directory within "data"; contains the directories with the data

.question[üëâ **Your Turn**: Load the data into RStudio. It will take a while...so just let it get started.]

---

## Demographic &amp; Population Data

.panelset[
.panel[.panel-name[Code]
.small[

```r
dem_77_79 &lt;- read_csv("data/raw/Demographics/Decade_1970/pe-19.csv", skip = 5)

dem_80_89 &lt;- list.files(recursive = TRUE,
                  path = "data/raw/Demographics/Decade_1980",
                  pattern = "*.csv",
                  full.names = TRUE) |&gt; 
  purrr::map(~read_csv(., skip=5))

dem_90_99 &lt;- list.files(recursive = TRUE,
                  path = "data/raw/Demographics/Decade_1990",
                  pattern = "*.txt",
                  full.names = TRUE) |&gt; 
  map(~read_table2(., skip = 14))


dem_00_10 &lt;- list.files(recursive = TRUE,
                  path = "data/raw/Demographics/Decade_2000",
                  pattern = "*.csv",
                   full.names = TRUE) |&gt; 
   map(~read_csv(.))
```

Source: US Census Bureau Data
]
]
.panel[.panel-name[Data]

```r
glimpse(dem_00_10[[1]])
```

```
## Rows: 62,244
## Columns: 21
## $ REGION            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
## $ DIVISION          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
## $ STATE             &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0", "0‚Ä¶
## $ NAME              &lt;chr&gt; "United States", "United States", "Un‚Ä¶
## $ SEX               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
## $ ORIGIN            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
## $ RACE              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
## $ AGEGRP            &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,‚Ä¶
## $ ESTIMATESBASE2000 &lt;dbl&gt; 281424600, 19176154, 20549855, 205284‚Ä¶
## $ POPESTIMATE2000   &lt;dbl&gt; 282162411, 19178293, 20463852, 206376‚Ä¶
## $ POPESTIMATE2001   &lt;dbl&gt; 284968955, 19298217, 20173362, 209786‚Ä¶
## $ POPESTIMATE2002   &lt;dbl&gt; 287625193, 19429192, 19872417, 212614‚Ä¶
## $ POPESTIMATE2003   &lt;dbl&gt; 290107933, 19592446, 19620851, 214153‚Ä¶
## $ POPESTIMATE2004   &lt;dbl&gt; 292805298, 19785885, 19454237, 214116‚Ä¶
## $ POPESTIMATE2005   &lt;dbl&gt; 295516599, 19917400, 19389067, 212125‚Ä¶
## $ POPESTIMATE2006   &lt;dbl&gt; 298379912, 19938883, 19544688, 210331‚Ä¶
## $ POPESTIMATE2007   &lt;dbl&gt; 301231207, 20125962, 19714611, 208410‚Ä¶
## $ POPESTIMATE2008   &lt;dbl&gt; 304093966, 20271127, 19929602, 207066‚Ä¶
## $ POPESTIMATE2009   &lt;dbl&gt; 306771529, 20244518, 20182499, 206605‚Ä¶
## $ CENSUS2010POP     &lt;dbl&gt; 308745538, 20201362, 20348657, 206771‚Ä¶
## $ POPESTIMATE2010   &lt;dbl&gt; 309349689, 20200529, 20382409, 206940‚Ä¶
```
]
]

---

## State FIPS Codes
.panelset[
.panel[.panel-name[Image]
![FIPS](img/16/FIPS.png)
]
.panel[.panel-name[Code]

```r
STATE_FIPS &lt;- readxl::read_xls("data/raw/State_FIPS_codes/state-geocodes-v2014.xls", skip = 5)
```
]
.panel[.panel-name[Data]

```r
glimpse(STATE_FIPS)
```

```
## Rows: 64
## Columns: 4
## $ Region          &lt;chr&gt; "1", "1", "1", "1", "1", "1", "1", "1",‚Ä¶
## $ Division        &lt;chr&gt; "0", "1", "1", "1", "1", "1", "1", "1",‚Ä¶
## $ `State\n(FIPS)` &lt;chr&gt; "00", "00", "09", "23", "25", "33", "44‚Ä¶
## $ Name            &lt;chr&gt; "Northeast Region", "New England Divisi‚Ä¶
```
]
.panel[.panel-name[Wrangling]

```r
STATE_FIPS &lt;- STATE_FIPS |&gt;
  rename(STATEFP = `State\n(FIPS)`,
         STATE = Name) |&gt;
  select(STATEFP, STATE) |&gt;
  filter(STATEFP != "00")

STATE_FIPS
```

```
## # A tibble: 51 √ó 2
##   STATEFP STATE        
##   &lt;chr&gt;   &lt;chr&gt;        
## 1 09      Connecticut  
## 2 23      Maine        
## 3 25      Massachusetts
## 4 33      New Hampshire
## 5 44      Rhode Island 
## 6 50      Vermont      
## # ‚Ä¶ with 45 more rows
```
]]

---

## Police Staffing Data

.panelset[
.panel[.panel-name[Code]

```r
ps_data &lt;- read_csv("data/raw/Police_staffing/pe_1960_2018.csv",
                    col_types =  cols(male_total_ct = col_double(),
                                      female_total_ct = col_double()))
```
]
.panel[.panel-name[Data]

```r
glimpse(ps_data)
```

```
## Rows: 1,439,467
## Columns: 21
## $ data_year             &lt;dbl&gt; 1960, 1960, 1960, 1960, 1960, 196‚Ä¶
## $ ori                   &lt;chr&gt; "AK020045Y", "AL0011000", "AL0160‚Ä¶
## $ pub_agency_name       &lt;chr&gt; "Alcohol Beverage Control Board",‚Ä¶
## $ pub_agency_unit       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ state_abbr            &lt;chr&gt; "AK", "AL", "AL", "AL", "AL", "AL‚Ä¶
## $ division_name         &lt;chr&gt; "Pacific", "East South Central", ‚Ä¶
## $ region_name           &lt;chr&gt; "West", "South", "South", "South"‚Ä¶
## $ county_name           &lt;chr&gt; "N/A", "JEFFERSON", "N/A", "COFFE‚Ä¶
## $ agency_type_name      &lt;chr&gt; "Other State Agency", "City", "Ci‚Ä¶
## $ population_group_desc &lt;chr&gt; "Cities under 2,500", "Cities fro‚Ä¶
## $ population            &lt;dbl&gt; 0, 20289, 0, 14852, 0, 3081, 0, 1‚Ä¶
## $ male_officer_ct       &lt;dbl&gt; NA, 17, NA, 0, NA, 0, NA, 0, 0, N‚Ä¶
## $ male_civilian_ct      &lt;dbl&gt; NA, 3, NA, 0, NA, 0, NA, 0, 0, NA‚Ä¶
## $ male_total_ct         &lt;dbl&gt; NA, 20, NA, 0, NA, 0, NA, 0, 0, N‚Ä¶
## $ female_officer_ct     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ female_civilian_ct    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ female_total_ct       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ officer_ct            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ civilian_ct           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ total_pe_ct           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
## $ pe_ct_per_1000        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶
```
]]

---

## Unemployment Data

.panelset[
.panel[.panel-name[Image]
![unemployment](img/16/unemp.png)
]
.panel[.panel-name[Code-data]

```r
 ue_rate_data &lt;- list.files(recursive = TRUE,
                            path = "data/raw/Unemployment",
                            pattern = "*.xlsx",
                            full.names = TRUE) |&gt; 
  map(~read_xlsx(., skip = 10))
```
]
.panel[.panel-name[Code-names]

```r
ue_rate_names &lt;- list.files(recursive = TRUE,
                            path = "data/raw/Unemployment",
                            pattern = "*.xlsx",
                            full.names = TRUE) %&gt;%
  map(~read_xlsx(., range = "B4:B6")) %&gt;%
  map(., c(1,2)) |&gt;
  unlist()

names(ue_rate_data) &lt;- ue_rate_names
```
]
.panel[.panel-name[Data]

```r
head(ue_rate_data)[1]
```

```
## $Alabama
## # A tibble: 44 √ó 14
##    Year   Jan   Feb   Mar   Apr   May   Jun   Jul   Aug   Sep
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1977   7.5   9     7.7   7.2   6.8   8.6   8     7.8   6.7
## 2  1978   7.1   6.9   6.2   5.4   5.1   6.9   6.7   6.7   6.5
## 3  1979   6.7   7.5   6.9   6.6   6.4   8.4   7.7   7.8   7.1
## 4  1980   7.7   7.8   7.4   7.4   8.4   9.7  10.4  10.3   9.3
## 5  1981  10    10.3   9.5   9.1   9.4  11.1  10.4  10.9  10.8
## 6  1982  13.2  13.2  12.9  12.6  12.8  14.5  14.7  14.8  14.7
## # ‚Ä¶ with 38 more rows, and 4 more variables: Oct &lt;dbl&gt;,
## #   Nov &lt;dbl&gt;, Dec &lt;dbl&gt;, Annual &lt;dbl&gt;
```
]
.panel[.panel-name[Wrangle]

```r
ue_rate_data &lt;- ue_rate_data |&gt;
  map_df(bind_rows, .id = "STATE") |&gt;
  select(STATE, Year, Annual) |&gt;
  rename("YEAR" = Year,
         "VALUE" = Annual) |&gt;
  mutate(VARIABLE = "Unemployment_rate")

ue_rate_data
```

```
## # A tibble: 2,244 √ó 4
##   STATE    YEAR VALUE VARIABLE         
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            
## 1 Alabama  1977   7.3 Unemployment_rate
## 2 Alabama  1978   6.4 Unemployment_rate
## 3 Alabama  1979   7.2 Unemployment_rate
## 4 Alabama  1980   8.9 Unemployment_rate
## 5 Alabama  1981  10.6 Unemployment_rate
## 6 Alabama  1982  14.1 Unemployment_rate
## # ‚Ä¶ with 2,238 more rows
```

]
]
---

## Poverty Data

.panelset[
.panel[.panel-name[Code]

```r
poverty_rate_data &lt;- read_xls("data/raw/Poverty/hstpov21.xls", skip=2)
```
]
.panel[.panel-name[Data]

```r
head(poverty_rate_data)
```

```
## # A tibble: 6 √ó 6
##   `NOTE: Number in thousands.` ...2  ...3   ...4    ...5   ...6  
##   &lt;chr&gt;                        &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; 
## 1 2018                         &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt; 
## 2 STATE                        Total Number "Stand‚Ä¶ Perce‚Ä¶ "Stan‚Ä¶
## 3 Alabama                      4877  779    "65"    16     "1.3" 
## 4 Alaska                       720   94     "9"     13.1   "1.2" 
## 5 Arizona                      7241  929    "80"    12.80‚Ä¶ "1.10‚Ä¶
## 6 Arkansas                     2912  462    "38"    15.9   "1.3"
```
]]

Source: US Census Bureau Data

---

## Violent Crime Data

.panelset[
.panel[.panel-name[Code]

```r
crime_data &lt;- read_lines("data/raw/Crime/CrimeStatebyState.csv",
                         skip = 2, 
                         skip_empty_rows = TRUE)
```

Due to spaces and `/` in the column names, `read_lines()` from the readr package works better than `read_csv()` 

]
.panel[.panel-name[Data]

```r
head(crime_data)
```

```
## [1] "Estimated crime in Alabama"                                                                                                         
## [2] ",,National or state crime,,,,,,,"                                                                                                   
## [3] ",,Violent crime,,,,,,,"                                                                                                             
## [4] "Year,Population,Violent crime total,Murder and nonnegligent Manslaughter,Legacy rape /1,Revised rape /2,Robbery,Aggravated assault,"
## [5] "1977,   3690000,      15293,         524,         929,,       3572,      10268 "                                                    
## [6] "1978,   3742000,      15682,         499,         954,,       3708,      10521 "
```
]]

---

## Right-To-Carry Data

.panelset[
.panel[.panel-name[Code]

```r
DAWpaper &lt;- pdf_text("data/raw/w23510.pdf")
```


]
.panel[.panel-name[Data]

```r
head(DAWpaper[1])
```

```
## [1] "                              NBER WORKING PAPER SERIES\n\n\n\n                  RIGHT-TO-CARRY LAWS AND VIOLENT CRIME:\n             A COMPREHENSIVE ASSESSMENT USING PANEL DATA AND\n                 A STATE-LEVEL SYNTHETIC CONTROL ANALYSIS\n\n                                        John J. Donohue\n                                          Abhay Aneja\n                                         Kyle D. Weber\n\n                                      Working Paper 23510\n                              http://www.nber.org/papers/w23510\n\n\n                     NATIONAL BUREAU OF ECONOMIC RESEARCH\n                              1050 Massachusetts Avenue\n                                 Cambridge, MA 02138\n                           June 2017, Revised November 2018\n\n\n\nPreviously circulated as \"Right-to-Carry Laws and Violent Crime: A Comprehensive Assessment\nUsing Panel Data and a State-Level Synthetic Controls Analysis.\" We thank Dan Ho, Stefano\nDellaVigna, Rob Tibshirani, Trevor Hastie, StefanWager, Jeff Strnad, and participants at the\n2011 Conference of Empirical Legal Studies (CELS), 2012 American Law and Economics\nAssociation (ALEA) Annual Meeting, 2013 Canadian Law and Economics Association (CLEA)\nAnnual Meeting, 2015 NBER Summer Institute (Crime), and the Stanford Law School faculty\nworkshop for their comments and helpful suggestions. Financial support was provided by\nStanford Law School. We are indebted to Alberto Abadie, Alexis Diamond, and Jens\nHainmueller for their work developing the synthetic control algorithm and programming the Stata\nmodule used in this paper and for their helpful comments. The authors would also like to thank\nAlex Albright, Andrew Baker, Jacob Dorn, Bhargav Gopal, Crystal Huang, Mira Korb, Haksoo\nLee, Isaac Rabbani, Akshay Rao, Vikram Rao, Henrik Sachs and Sidharth Sah who provided\nexcellent research assistance, as well as Addis O‚ÄôConnor and Alex Chekholko at the Research\nComputing division of Stanford‚Äôs Information Technology Services for their technical support.\nThe views expressed herein are those of the author and do not necessarily reflect the views of the\nNational Bureau of Economic Research.\n\nNBER working papers are circulated for discussion and comment purposes. They have not been\npeer-reviewed or been subject to the review by the NBER Board of Directors that accompanies\nofficial NBER publications.\n\n¬© 2017 by John J. Donohue, Abhay Aneja, and Kyle D. Weber. All rights reserved. Short\nsections of text, not to exceed two paragraphs, may be quoted without explicit permission\nprovided that full credit, including ¬© notice, is given to the source.\n"
```
]]

---

## Save (Imported) Data


```r
save(dem_77_79, dem_80_89, dem_90_99, dem_00_10, #demographic data
     STATE_FIPS, # codes for states 
     ps_data, # police staffing data
     ue_rate_data, # unemployment data
     poverty_rate_data, # poverty data
     crime_data, # crime data
     DAWpaper, file = "data/imported_data_rtc.rda")
```

---

## Wrangle: Demo Data I

.panelset[
.panel[.panel-name[77-79-1]
.small[

```r
dem_77_79 &lt;- dem_77_79 |&gt;
  rename("race_sex" =`Race/Sex Indicator`) |&gt;
  mutate(SEX = str_extract(race_sex, "male|female"),
        RACE = str_extract(race_sex, "Black|White|Other"))|&gt;
  select(-`FIPS State Code`, -`race_sex`) |&gt;
  rename("YEAR" = `Year of Estimate`,
        "STATE" = `State Name`) |&gt;
  filter(YEAR %in% 1977:1979)

dem_77_79 &lt;- dem_77_79 |&gt;
  pivot_longer(cols=contains("years"),
               names_to = "AGE_GROUP",
               values_to = "SUB_POP")
```
]]
.panel[.panel-name[77-79-2]

```r
glimpse(dem_77_79)
```

```
## Rows: 16,524
## Columns: 6
## $ YEAR      &lt;dbl&gt; 1977, 1977, 1977, 1977, 1977, 1977, 1977, 197‚Ä¶
## $ STATE     &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "‚Ä¶
## $ SEX       &lt;chr&gt; "male", "male", "male", "male", "male", "male‚Ä¶
## $ RACE      &lt;chr&gt; "White", "White", "White", "White", "White", ‚Ä¶
## $ AGE_GROUP &lt;chr&gt; "Under 5 years", "5 to 9 years", "10 to 14 ye‚Ä¶
## $ SUB_POP   &lt;dbl&gt; 98814, 113365, 123107, 135343, 126053, 111547‚Ä¶
```
]
.panel[.panel-name[80s-1]
.small[

```r
dem_80_89 &lt;- dem_80_89 |&gt;
  map_df(bind_rows)

dem_80_89 &lt;- dem_80_89 |&gt;
  rename("race_sex" =`Race/Sex Indicator`) |&gt;
  mutate(SEX = str_extract(race_sex, "male|female"),
        RACE = str_extract(race_sex, "Black|White|Other"))|&gt;
  select( -`race_sex`) |&gt;
  rename("YEAR" = `Year of Estimate`) |&gt; 
  rename("STATEFP_temp" = "FIPS State and County Codes") |&gt;
  mutate(STATEFP = str_sub(STATEFP_temp, start = 1, end = 2)) |&gt;
    left_join(STATE_FIPS, by = "STATEFP") |&gt;
  select(-STATEFP)
```
]
]
.panel[.panel-name[80s-2]

```r
dem_80_89 &lt;- dem_80_89 |&gt;
  pivot_longer(cols=contains("years"),
               names_to = "AGE_GROUP",
               values_to = "SUB_POP_temp") |&gt;
  group_by(YEAR, STATE, AGE_GROUP, SEX, RACE) |&gt;
  summarize(SUB_POP = sum(SUB_POP_temp), .groups="drop")

dem_80_89
```

```
## # A tibble: 55,080 √ó 6
##    YEAR STATE   AGE_GROUP      SEX    RACE  SUB_POP
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
## 1  1980 Alabama 10 to 14 years female Black   50108
## 2  1980 Alabama 10 to 14 years female Other     805
## 3  1980 Alabama 10 to 14 years female White  109066
## 4  1980 Alabama 10 to 14 years male   Black   50768
## 5  1980 Alabama 10 to 14 years male   Other     826
## 6  1980 Alabama 10 to 14 years male   White  115988
## # ‚Ä¶ with 55,074 more rows
```

]
]

---

## Wrangle: Demo Data II

.panelset[
.panel[.panel-name[90s-1]
.small[

```r
dem_90_99 &lt;- dem_90_99 |&gt;
  map_df(bind_rows)

colnames(dem_90_99) &lt;- c("YEAR", "STATEFP", "Age", "NH_W_M", "NH_W_F", "NH_B_M",
                         "NH_B_F", "NH_AIAN_M", "NH_AIAN_F", "NH_API_M", "NH_API_F",
                         "H_W_M", "H_W_F", "H_B_M", "H_B_F", "H_AIAN_M", "H_AIAN_F",
                         "H_API_M", "H_API_F")

dem_90_99 &lt;- dem_90_99 |&gt;
  drop_na() |&gt;
  mutate(W_M = NH_W_M + H_W_M, W_F = NH_W_F + H_W_F,
         B_M = NH_B_M + H_B_M, B_F = NH_B_F + H_B_F,
         AIAN_M = NH_AIAN_M + H_AIAN_M, AIAN_F = NH_AIAN_F + H_AIAN_F,
         API_M = NH_API_M + H_API_M, API_F = NH_API_F + H_API_F) |&gt;
  select(-starts_with("NH_"), -starts_with("H_"))
```
]
]
.panel[.panel-name[90s-2]
.small[

```r
dem_90_99 &lt;- dem_90_99 |&gt;
  mutate(AGE_GROUP = cut(Age,
                         breaks = seq(0, 90, by=5),
                         right = FALSE, labels = pull(distinct(dem_77_79,AGE_GROUP), AGE_GROUP))) |&gt;
  select(-Age) |&gt;
  pivot_longer(cols = c(starts_with("W_"),
                        starts_with("B_"),
                        starts_with("AIAN_"),
                        starts_with("API_")),
               names_to = "RACE",
               values_to = "SUB_POP_temp") |&gt;
  mutate(SEX = case_when(str_detect(RACE, "_M") ~ "Male",
                         TRUE ~ "Female"),
         RACE = case_when(str_detect(RACE, "W_") ~ "White",
                          str_detect(RACE, "B_") ~ "Black",
                          TRUE ~ "Other"))
```
]
]
.panel[.panel-name[90s-3]
.small[

```r
dem_90_99 &lt;- dem_90_99 |&gt;
  left_join(STATE_FIPS, by = "STATEFP") |&gt;
  select(-STATEFP) |&gt;
  group_by(YEAR, STATE, AGE_GROUP, SEX, RACE) |&gt;
  summarize(SUB_POP = sum(SUB_POP_temp), .groups="drop")

glimpse(dem_90_99)
```

```
## Rows: 55,080
## Columns: 6
## $ YEAR      &lt;dbl&gt; 1990, 1990, 1990, 1990, 1990, 1990, 1990, 199‚Ä¶
## $ STATE     &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "‚Ä¶
## $ AGE_GROUP &lt;fct&gt; Under 5 years, Under 5 years, Under 5 years, ‚Ä¶
## $ SEX       &lt;chr&gt; "Female", "Female", "Female", "Male", "Male",‚Ä¶
## $ RACE      &lt;chr&gt; "Black", "Other", "White", "Black", "Other", ‚Ä¶
## $ SUB_POP   &lt;dbl&gt; 45377, 1406, 92380, 46635, 1360, 98524, 46067‚Ä¶
```
]
]
.panel[.panel-name[00s-1]
.small[

```r
dem_00_10 &lt;- dem_00_10 |&gt;
  map_df(bind_rows)

dem_00_10 &lt;- dem_00_10 |&gt;
  select(-ESTIMATESBASE2000,-CENSUS2010POP) |&gt;
  filter(NAME != "United States",
         SEX != 0,
         RACE != 0,
         AGEGRP != 0, 
         ORIGIN == 0) |&gt;
  select(-REGION, -DIVISION, -ORIGIN, -STATE) |&gt;
  rename("STATE" = NAME,
         "AGE_GROUP" = AGEGRP)
```
]
.panel[.panel-name[00s-2]

```r
dem_00_10 &lt;- dem_00_10 |&gt;
  mutate(SEX = factor(SEX, levels = 1:2, labels = c("Male", "Female")),
         RACE = factor(RACE, levels = 1:6, labels = c("White", "Black", rep("Other",4))),
         AGE_GROUP = factor(AGE_GROUP, levels = 1:18,
                            labels = pull(distinct(dem_77_79,AGE_GROUP), AGE_GROUP)))

dem_00_10 &lt;- dem_00_10 |&gt;
  pivot_longer(cols=contains("ESTIMATE"), names_to = "YEAR", values_to = "SUB_POP_temp") |&gt;
   mutate(YEAR = str_sub(YEAR, start=-4),
          YEAR = as.numeric(YEAR)) |&gt; 
  group_by(YEAR, AGE_GROUP, STATE, SEX, RACE) |&gt;
  summarize(SUB_POP = sum(SUB_POP_temp), .groups = "drop")
                            
glimpse(dem_00_10)
```

```
## Rows: 60,588
## Columns: 6
## $ YEAR      &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 200‚Ä¶
## $ AGE_GROUP &lt;fct&gt; Under 5 years, Under 5 years, Under 5 years, ‚Ä¶
## $ STATE     &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "‚Ä¶
## $ SEX       &lt;fct&gt; Male, Male, Male, Female, Female, Female, Mal‚Ä¶
## $ RACE      &lt;fct&gt; White, Black, Other, White, Black, Other, Whi‚Ä¶
## $ SUB_POP   &lt;dbl&gt; 99527, 46595, 4487, 94473, 45672, 4431, 14765‚Ä¶
```
]
]
]

---

### Wrangle: Population Data

.panelset[
.panel[.panel-name[1977-79]

```r
pop_77_79 &lt;- dem_77_79 |&gt;
  group_by(YEAR, STATE) |&gt;
  summarize(TOT_POP = sum(SUB_POP), .groups = "drop") 

pop_77_79 
```

```
## # A tibble: 153 √ó 3
##    YEAR STATE       TOT_POP
##   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
## 1  1977 Alabama     3782571
## 2  1977 Alaska       397220
## 3  1977 Arizona     2427296
## 4  1977 Arkansas    2207195
## 5  1977 California 22350332
## 6  1977 Colorado    2696179
## # ‚Ä¶ with 147 more rows
```
]
.panel[.panel-name[80s]

```r
pop_80_89 &lt;- dem_80_89 |&gt;
  group_by(YEAR, STATE) |&gt;
  summarize(TOT_POP = sum(SUB_POP), .groups = "drop") 
```

]
.panel[.panel-name[90s]

```r
pop_90_99 &lt;- dem_90_99 |&gt;
  group_by(YEAR, STATE) |&gt;
  summarize(TOT_POP = sum(SUB_POP), .groups = "drop")
```

]
.panel[.panel-name[00s]

```r
pop_00_10 &lt;- dem_00_10 |&gt;
  group_by(YEAR, STATE) |&gt;
  summarize(TOT_POP = sum(SUB_POP), .groups = "drop")
```

]]

---

### Combine: Demo + Population

.panelset[
.panel[.panel-name[77-79]

```r
dem_77_79 &lt;- dem_77_79 |&gt;
  left_join(pop_77_79, by = c("YEAR", "STATE")) |&gt; 
  mutate(PERC_SUB_POP = (SUB_POP/TOT_POP)*100) |&gt;
  select(-SUB_POP, -TOT_POP)

dem_77_79
```

```
## # A tibble: 16,524 √ó 6
##    YEAR STATE   SEX   RACE  AGE_GROUP      PERC_SUB_POP
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1  1977 Alabama male  White Under 5 years          2.61
## 2  1977 Alabama male  White 5 to 9 years           3.00
## 3  1977 Alabama male  White 10 to 14 years         3.25
## 4  1977 Alabama male  White 15 to 19 years         3.58
## 5  1977 Alabama male  White 20 to 24 years         3.33
## 6  1977 Alabama male  White 25 to 29 years         2.95
## # ‚Ä¶ with 16,518 more rows
```
]
.panel[.panel-name[80s]


```r
dem_80_89 &lt;- dem_80_89 |&gt;
  left_join(pop_80_89, by = c("YEAR", "STATE")) |&gt;
  mutate(PERC_SUB_POP = (SUB_POP/TOT_POP)*100) |&gt;
  select(-SUB_POP, -TOT_POP) |&gt;
  mutate(SEX = str_to_title(SEX))
```

]
.panel[.panel-name[90s]

```r
dem_90_99 &lt;- dem_90_99 |&gt;
  left_join(pop_90_99, by = c("YEAR", "STATE")) |&gt;
  mutate(PERC_SUB_POP = (SUB_POP/TOT_POP)*100) |&gt;
  select(-SUB_POP, -TOT_POP)

dem_90_99
```

```
## # A tibble: 55,080 √ó 6
##    YEAR STATE   AGE_GROUP     SEX    RACE  PERC_SUB_POP
##   &lt;dbl&gt; &lt;chr&gt;   &lt;fct&gt;         &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;
## 1  1990 Alabama Under 5 years Female Black       1.12  
## 2  1990 Alabama Under 5 years Female Other       0.0347
## 3  1990 Alabama Under 5 years Female White       2.28  
## 4  1990 Alabama Under 5 years Male   Black       1.15  
## 5  1990 Alabama Under 5 years Male   Other       0.0336
## 6  1990 Alabama Under 5 years Male   White       2.43  
## # ‚Ä¶ with 55,074 more rows
```

]
.panel[.panel-name[00s]

```r
dem_00_10 &lt;- dem_00_10 |&gt;
  left_join(pop_00_10, by = c("YEAR", "STATE")) |&gt;
  mutate(PERC_SUB_POP = (SUB_POP/TOT_POP)*100) |&gt;
 select(-SUB_POP, -TOT_POP)

dem_00_10
```

```
## # A tibble: 60,588 √ó 6
##    YEAR AGE_GROUP     STATE   SEX    RACE  PERC_SUB_POP
##   &lt;dbl&gt; &lt;fct&gt;         &lt;chr&gt;   &lt;fct&gt;  &lt;fct&gt;        &lt;dbl&gt;
## 1  2000 Under 5 years Alabama Male   White       2.24  
## 2  2000 Under 5 years Alabama Male   Black       1.05  
## 3  2000 Under 5 years Alabama Male   Other       0.101 
## 4  2000 Under 5 years Alabama Female White       2.12  
## 5  2000 Under 5 years Alabama Female Black       1.03  
## 6  2000 Under 5 years Alabama Female Other       0.0995
## # ‚Ä¶ with 60,582 more rows
```

]]

---

## Combine: Demo Data


```r
dem &lt;- bind_rows(dem_77_79,
                 dem_80_89,
                 dem_90_99,
                 dem_00_10)

glimpse(dem)
```

```
## Rows: 187,272
## Columns: 6
## $ YEAR         &lt;dbl&gt; 1977, 1977, 1977, 1977, 1977, 1977, 1977, ‚Ä¶
## $ STATE        &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama"‚Ä¶
## $ SEX          &lt;chr&gt; "male", "male", "male", "male", "male", "m‚Ä¶
## $ RACE         &lt;chr&gt; "White", "White", "White", "White", "White‚Ä¶
## $ AGE_GROUP    &lt;chr&gt; "Under 5 years", "5 to 9 years", "10 to 14‚Ä¶
## $ PERC_SUB_POP &lt;dbl&gt; 2.6123502, 2.9970356, 3.2545853, 3.5780690‚Ä¶
```



---

### Demographic Data (Donohue)

.panelset[
.panel[.panel-name[1]

```r
DONOHUE_AGE_GROUPS &lt;- c("15 to 19 years",
                        "20 to 24 years",
                        "25 to 29 years",
                        "30 to 34 years",
                        "35 to 39 years")

dem_DONOHUE &lt;- dem |&gt;
  filter(AGE_GROUP %in% DONOHUE_AGE_GROUPS,
               SEX == "Male") |&gt;
  mutate(AGE_GROUP = fct_collapse(AGE_GROUP, "20 to 39 years"=c("20 to 24 years",
                                                                "25 to 29 years",
                                                                "30 to 34 years",
                                                                "35 to 39 years")))
```
]
.panel[.panel-name[2]


```r
dem_DONOHUE &lt;- dem_DONOHUE |&gt;
  mutate(AGE_GROUP = str_replace_all(string = AGE_GROUP, 
                                     pattern = " ", 
                                     replacement = "_")) |&gt;
  group_by(YEAR, STATE, RACE, SEX, AGE_GROUP) |&gt;
  summarize(PERC_SUB_POP = sum(PERC_SUB_POP), .groups = "drop")

dem_DONOHUE
```

```
## # A tibble: 9,486 √ó 6
##    YEAR STATE   RACE  SEX   AGE_GROUP      PERC_SUB_POP
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1  1980 Alabama Black Male  15_to_19_years       1.46  
## 2  1980 Alabama Black Male  20_to_39_years       3.36  
## 3  1980 Alabama Other Male  15_to_19_years       0.0213
## 4  1980 Alabama Other Male  20_to_39_years       0.0861
## 5  1980 Alabama White Male  15_to_19_years       3.40  
## 6  1980 Alabama White Male  20_to_39_years      11.6   
## # ‚Ä¶ with 9,480 more rows
```
]
.panel[.panel-name[3]

```r
dem_DONOHUE &lt;- dem_DONOHUE |&gt;
  unite(col = "VARIABLE", RACE, SEX, AGE_GROUP, sep = "_") |&gt;
  rename("VALUE" = PERC_SUB_POP)

dem_DONOHUE
```

```
## # A tibble: 9,486 √ó 4
##    YEAR STATE   VARIABLE                    VALUE
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;                       &lt;dbl&gt;
## 1  1980 Alabama Black_Male_15_to_19_years  1.46  
## 2  1980 Alabama Black_Male_20_to_39_years  3.36  
## 3  1980 Alabama Other_Male_15_to_19_years  0.0213
## 4  1980 Alabama Other_Male_20_to_39_years  0.0861
## 5  1980 Alabama White_Male_15_to_19_years  3.40  
## 6  1980 Alabama White_Male_20_to_39_years 11.6   
## # ‚Ä¶ with 9,480 more rows
```
]]

---

### Demographic Data (Lott)

.panelset[
.panel[.panel-name[1]
.small[

```r
LOTT_AGE_GROUPS_NULL &lt;- c("Under 5 years",
                          "5 to 9 years")

dem_LOTT &lt;- dem |&gt;
  filter(!(AGE_GROUP %in% LOTT_AGE_GROUPS_NULL) )|&gt;
  mutate(AGE_GROUP = fct_collapse(AGE_GROUP,
                                  "10 to 19 years"=c("10 to 14 years", "15 to 19 years"),
                                  "20 to 29 years"=c("20 to 24 years", "25 to 29 years"),
                                  "30 to 39 years"=c("30 to 34 years", "35 to 39 years"),
                                  "40 to 49 years"=c("40 to 44 years", "45 to 49 years"),
                                  "50 to 64 years"=c("50 to 54 years", "55 to 59 years",
                                                     "60 to 64 years"),
                                  "65 years and over"=c("65 to 69 years", "70 to 74 years", 
                                                        "75 to 79 years", "80 to 84 years",
                                                        "85 years and over"))) 
```
]]
.panel[.panel-name[2]

```r
dem_LOTT &lt;- dem_LOTT |&gt;
  mutate(AGE_GROUP = str_replace_all(AGE_GROUP, " ", "_")) |&gt;
  group_by(YEAR, STATE, RACE, SEX, AGE_GROUP) |&gt;
  summarize(PERC_SUB_POP = sum(PERC_SUB_POP), .groups = "drop") |&gt;
  unite(col = "VARIABLE", RACE, SEX, AGE_GROUP, sep = "_") |&gt;
  rename("VALUE" = PERC_SUB_POP)

glimpse(dem_LOTT)
```

```
## Rows: 62,424
## Columns: 4
## $ YEAR     &lt;dbl&gt; 1977, 1977, 1977, 1977, 1977, 1977, 1977, 1977‚Ä¶
## $ STATE    &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "A‚Ä¶
## $ VARIABLE &lt;chr&gt; "Black_female_10_to_19_years", "Black_female_2‚Ä¶
## $ VALUE    &lt;dbl&gt; 3.01067713, 2.32860137, 1.29295656, 1.18231753‚Ä¶
```

]]

---

## Combine: Population Data


```r
population_data &lt;- bind_rows(pop_77_79,
                             pop_80_89,
                             pop_90_99,
                             pop_00_10)

population_data &lt;- population_data |&gt;
  mutate(VARIABLE = "Population") |&gt;
  rename("VALUE" = TOT_POP)
```

---

## Wrangling: Police staffing


```r
ps_data &lt;- ps_data |&gt;
  filter(data_year &gt;= 1977, 
         data_year &lt;= 2014) |&gt;
  mutate(across(.cols =contains("total_ct"), ~replace_na(., 0)),
         officer_total = male_total_ct + female_total_ct) |&gt;
  select(data_year,
         pub_agency_name,
         state_abbr,
         officer_total) |&gt;
  group_by(data_year, state_abbr) |&gt;
  summarize(officer_state_total = sum(officer_total), .groups = "drop")

ps_data
```

```
## # A tibble: 2,242 √ó 3
##   data_year state_abbr officer_state_total
##       &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;
## 1      1977 AK                         544
## 2      1977 AL                        7380
## 3      1977 AR                        3344
## 4      1977 AS                           0
## 5      1977 AZ                        6414
## 6      1977 CA                       65596
## # ‚Ä¶ with 2,236 more rows
```

---
## Police staffing - remove territories


```r
state_of_interest_NULL &lt;- c("AS", "GM", "CZ", "FS", "MP", "OT", "PR", "VI")

ps_data &lt;- ps_data |&gt;
  filter(!(state_abbr %in% state_of_interest_NULL)) 
```

---

### Use `state` abbreviations


```r
state_abb_data &lt;- tibble("state_abbr" = state.abb, "STATE" = state.name)
state_abb_data &lt;- state_abb_data |&gt;
  mutate(state_abbr = str_replace(string = state_abbr, 
                                  pattern = "NE", 
                                  replacement = "NB")) |&gt;
  add_row(state_abbr = "DC", STATE = "District of Columbia")

ps_data &lt;- ps_data |&gt; 
  left_join(state_abb_data, by = "state_abbr") |&gt;
  select(-state_abbr) |&gt; 
  rename(YEAR = "data_year",
         VALUE = "officer_state_total") |&gt;
  mutate(VARIABLE = "officer_state_total")

ps_data
```

```
## # A tibble: 1,938 √ó 4
##    YEAR VALUE STATE      VARIABLE           
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;              
## 1  1977   544 Alaska     officer_state_total
## 2  1977  7380 Alabama    officer_state_total
## 3  1977  3344 Arkansas   officer_state_total
## 4  1977  6414 Arizona    officer_state_total
## 5  1977 65596 California officer_state_total
## 6  1977  7337 Colorado   officer_state_total
## # ‚Ä¶ with 1,932 more rows
```

---

### Police staffing: scaling


```r
denominator_temp &lt;- population_data |&gt; 
  select(-VARIABLE) |&gt;
  rename("Population_temp"=VALUE) 

ps_data &lt;- ps_data |&gt; 
  left_join(denominator_temp, by=c("STATE","YEAR")) |&gt;
  mutate(VALUE = (VALUE * 100000) / Population_temp) |&gt;
  mutate(VARIABLE = "police_per_100k_lag") |&gt;
  select(-Population_temp)

head(ps_data)
```

```
## # A tibble: 6 √ó 4
##    YEAR VALUE STATE      VARIABLE           
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;              
## 1  1977  137. Alaska     police_per_100k_lag
## 2  1977  195. Alabama    police_per_100k_lag
## 3  1977  152. Arkansas   police_per_100k_lag
## 4  1977  264. Arizona    police_per_100k_lag
## 5  1977  293. California police_per_100k_lag
## 6  1977  272. Colorado   police_per_100k_lag
```

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
